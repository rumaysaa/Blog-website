<div class="container" style="max-width: 900px; margin-top: 3%;">
    <h1 class="page-title">My Profile</h1>
    <p class="page-subtitle">Manage your account settings and profile</p>

    <div class="row">
        <div class="col-lg-4">
            <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); text-align: center;">
                <h5 style="margin-bottom: 1.5rem; color: var(--primary-color); font-weight: 700;">
                    <i class="fas fa-image" style="margin-right: 0.5rem;"></i>Profile Photo
                </h5>

                <div style="margin-bottom: 2rem;">
                    {{#if imageBase64}}
                    <img src="data:image/png;base64,{{imageBase64}}" alt="Profile" style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 4px solid var(--secondary-color);">
                    {{else}}
                    <img src="/Deafult-Profile-Pitcher.png" alt="Profile" style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 4px solid #e0e0e0;">
                    {{/if}}
                </div>

                <div id="divEditProfilePhoto">
                    <button type="button" onclick="editProfilePhoto(event);" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-camera" style="margin-right: 0.5rem;"></i>Change Photo
                    </button>
                </div>

                <div id="divProfilePhotoButtons" style="display: none;">
                    <form action="/users/profile" method="post" id="uploadProfileForm" enctype="multipart/form-data" style="border: 0;">
                        <div class="form-group">
                            <input type="file" id="profileImage" name="image" class="form-control" accept="image/*" required>
                            <small style="color: #7f8c8d; display: block; margin-top: 0.3rem;">Max 500KB</small>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button type="button" onclick="fileFunction()" class="btn btn-success" style="flex: 1;">
                                <i class="fas fa-check" style="margin-right: 0.5rem;"></i>Upload
                            </button>
                            <button type="button" onclick="cancelProfilePhoto()" class="btn btn-cancel" style="flex: 1;">
                                <i class="fas fa-times" style="margin-right: 0.5rem;"></i>Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-8">
            <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);">
                <form action="/users/editUser" method="post" id="myForm">
                    <h5 style="margin-bottom: 1.5rem; color: var(--primary-color); font-weight: 700;">
                        <i class="fas fa-user-circle" style="margin-right: 0.5rem;"></i>Account Information
                    </h5>

                    <div class="form-group">
                        <label class="form-label" for="mail">
                            <i class="fas fa-envelope" style="margin-right: 0.5rem;"></i>Email Address
                        </label>
                        <input 
                            type="email" 
                            id="mail" 
                            class="form-control" 
                            value="{{user.mail}}" 
                            disabled>
                        <small style="color: #7f8c8d; display: block; margin-top: 0.3rem;">
                            <i class="fas fa-lock"></i> Your email cannot be changed
                        </small>
                    </div>

                    <input type="hidden" value="{{user._id}}" name="id">

                    <div class="form-group">
                        <label class="form-label" for="name">
                            <i class="fas fa-user" style="margin-right: 0.5rem;"></i>Full Name
                        </label>
                        <div class="form-flex-group">
                            <input 
                                type="text" 
                                id="name" 
                                class="form-control" 
                                value="{{user.name}}"
                                name="name" 
                                disabled
                                style="flex: 1;">
                            <button 
                                type="button" 
                                id="editUserName" 
                                onclick="editName()" 
                                class="btn btn-primary btn-edit-icon">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    </div>

                    <div id="divUpdateNameButtons" style="display: none; display: flex; gap: 0.5rem; margin-top: 1rem;">
                        <button type="submit" class="btn btn-success" style="flex: 1;">
                            <i class="fas fa-check" style="margin-right: 0.5rem;"></i>Save Name
                        </button>
                        <button type="button" onclick="cancelEditName()" class="btn btn-cancel" style="flex: 1;">
                            <i class="fas fa-times" style="margin-right: 0.5rem;"></i>Cancel
                        </button>
                    </div>

                    <hr style="margin: 2rem 0;">

                    <a href="/users/changePassword" class="btn btn-warning" style="width: 100%;">
                        <i class="fas fa-key" style="margin-right: 0.5rem;"></i>Change Password
                    </a>
                </form>
            </div>
        </div>
    </div>

    <script>
        function editName() {
            document.getElementById("name").disabled = false;
            document.getElementById("editUserName").style.display = 'none';
            document.getElementById("divUpdateNameButtons").style.display = 'flex';
            document.getElementById("name").focus();
        }

        function cancelEditName() {
            document.getElementById("myForm").reset();
            document.getElementById("name").disabled = true;
            document.getElementById("editUserName").style.display = 'block';
            document.getElementById("divUpdateNameButtons").style.display = 'none';
        }

        function editProfilePhoto(e) {
            e.preventDefault();
            document.getElementById("divEditProfilePhoto").style.display = 'none';
            document.getElementById("divProfilePhotoButtons").style.display = 'block';
        }

        function cancelProfilePhoto() {
            document.getElementById("divProfilePhotoButtons").style.display = 'none';
            document.getElementById("divEditProfilePhoto").style.display = 'block';
        }

        function fileFunction() {
            var fileInput = document.getElementById("profileImage");
            if (fileInput.files[0]) {
                if (fileInput.files[0].size > 500000) {
                    alert("File size cannot exceed 500KB");
                } else {
                    document.getElementById("uploadProfileForm").submit();
                }
            } else {
                alert("Please select a file first");
            }
        }
    </script>
</div>